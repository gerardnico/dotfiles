#!/bin/bash
# Shows the pods ip (node name can be given for a smaller subset)

# flag
# e - Exit if any error
# u - Treat unset variables as an error when substituting
# o pipefail - the return value of a pipeline is the status of the last command to exit with a non-zero status or zero if no command exited with a non-zero status
# E - the ERR trap is inherited by shell functions
set -Eeuo pipefail

# Check if the app name is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <app name>"
    exit 1
fi

APP_NAME=$1
NS_NAME=$APP_NAME
echo "Getting pod name"
POD_NAME=$(kubectl get pod -l app="$APP_NAME" -o jsonpath='{.items[0].metadata.name}' -n "$NS_NAME")

echo "Getting pod events"
kubectl get event --namespace "$NS_NAME" --field-selector involvedObject.name="$POD_NAME"

echo ""
echo "Note: To see what fields are possible you can use kubectl describe on any event."
echo "Note: If no event, check namespace event"
