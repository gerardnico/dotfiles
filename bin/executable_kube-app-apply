#!/bin/bash
# Apply the kustomize app
######################
# Standard Library and conf
######################
# The log and error handling
# We still need to use the set command
# because shellcheck does not see them and want use to add
# exit check everywhere
set -Eeuo pipefail

# Load echo package
source $(libpath echo.sh)

######################
# Main
######################

if [ -z "$1" ]; then
    echo "Usage: $0 <app name>"
    exit 1
fi

APP_NAME=$1
APP_DIRECTORY=$HOME/code/kube-argocd/$APP_NAME


if [ ! -d "$APP_DIRECTORY" ]; then
  echo::err "The app directory $APP_DIRECTORY does not exist"
  exit 1
fi

pushd "$APP_DIRECTORY"

kubectl apply -k .

popd

echo "Done"